# üé∞ Documenta√ß√£o Completa - Sistema de An√°lise de Roleta

## üìã Vis√£o Geral

Este √© um sistema completo e avan√ßado para an√°lise de resultados de roleta, com foco em monitoramento de estrat√©gias, an√°lise estat√≠stica e identifica√ß√£o de padr√µes. O aplicativo foi desenvolvido com React, TypeScript, Tailwind CSS e utiliza Lovable Cloud (Supabase) para backend.

---

## üéØ Funcionalidades Principais

### 1. **Entrada de Dados**

#### 1.1 Entrada Manual de N√∫meros
- Grid interativo com todos os n√∫meros da roleta (0-36)
- Cada n√∫mero pode ser clicado para adicionar aos resultados
- Feedback visual imediato com toast notifications
- Suporte para tema claro/escuro

#### 1.2 Upload de Imagem com OCR
- Upload de fotos de telas de roleta
- Extra√ß√£o autom√°tica de n√∫meros usando IA (Google Gemini)
- Valida√ß√£o de tamanho de arquivo (m√°x 5MB)
- Processamento em lote de m√∫ltiplos n√∫meros
- Edge Function dedicada para processar imagens de forma segura

#### 1.3 Bot√µes de Controle
- **Desfazer**: Remove o √∫ltimo n√∫mero adicionado
- **Limpar Tudo**: Remove todos os resultados (com confirma√ß√£o)

---

### 2. **Sistema de Estrat√©gias**

#### 2.1 Tipos de Estrat√©gias Suportadas

##### **Cor (Color)**
- Monitora vermelho ou preto
- N√∫meros vermelhos: 1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36

##### **Paridade (Parity)**
- Par ou √≠mpar
- Zero √© ignorado (n√£o conta como par nem √≠mpar)

##### **Intervalo (Range)**
- Baixo (1-18) ou Alto (19-36)
- Zero √© ignorado

##### **D√∫zia (Dozen)**
- Primeira d√∫zia (1-12)
- Segunda d√∫zia (13-24)
- Terceira d√∫zia (25-36)

##### **Coluna (Column)**
- Primeira coluna: 1, 4, 7, 10, 13, 16, 19, 22, 25, 28, 31, 34
- Segunda coluna: 2, 5, 8, 11, 14, 17, 20, 23, 26, 29, 32, 35
- Terceira coluna: 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36

##### **N√∫mero Espec√≠fico**
- Monitora um n√∫mero exato (0-36)

##### **Vizinhos (Neighbors)**
- Monitora um n√∫mero base e seus vizinhos na roda f√≠sica
- Configur√°vel: quantos vizinhos de cada lado
- Ordem da roda: [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26]

##### **Conjunto de N√∫meros (Number Set)**
- Lista customizada de n√∫meros (ex: 1, 5, 9, 14, 18)
- Conta acertos consecutivos
- Registra sequ√™ncias (2+ acertos seguidos)
- **L√≥gica de Continuidade**: mesmo ap√≥s erro, se o pr√≥ximo n√∫mero estiver no conjunto, inicia nova base

##### **N√∫meros Alvo (Target Numbers)**
- **Base**: N√∫meros que iniciam a an√°lise
- **Alvos**: N√∫meros que devem aparecer ap√≥s a base
- **L√≥gica Especial**: 
  - Se um n√∫mero est√° na base E no alvo: conta como acerto E inicia nova base
  - Exemplo: Base [1,2,3], Alvo [3,4,5]
    - Sequ√™ncia 1‚Üí3: ‚úì Acerto (3 no alvo) + nova base (3 na base)
    - Sequ√™ncia 3‚Üí4: ‚úì Acerto
- **Continuidade**: n√∫mero que falhou pode iniciar nova an√°lise se estiver na base

#### 2.2 Cria√ß√£o de Estrat√©gias

```typescript
interface Strategy {
  id: string;
  name: string;
  type: StrategyType;
  sequence: StrategyValue[];
  value: any; // Espec√≠fico por tipo
  isActive: boolean;
  
  // Estat√≠sticas
  hits: number;
  misses: number;
  currentProgress: number;
  currentStreak: number;
  longestWinStreak: number;
  longestLossStreak: number;
  
  // Alertas
  alertOnWinStreak?: number;
  alertOnLossStreak?: number;
  isPriority: boolean;
  
  // Hist√≥rico
  history: Array<{
    spin: number;
    result: 'hit' | 'miss' | 'progress' | 'partial';
  }>;
  
  // Para number-set e target-numbers
  currentConsecutiveHits?: number;
  consecutiveHitStreaks?: Record<number, number>;
}
```

#### 2.3 Monitoramento de Estrat√©gias

**Interface Minimizada (padr√£o)**:
- Nome da estrat√©gia
- Switch liga/desliga
- Estat√≠sticas b√°sicas: ‚úì acertos | ‚úó erros | % taxa de acerto
- Streak atual (positivo = acertos, negativo = erros)
- **Pr√≥ximo segmento esperado** com badge destacado
- Progresso na sequ√™ncia (ex: 3/5)
- Bot√µes: Configura√ß√µes, Reset, Remover

**Interface Expandida**:
- Todos os dados da vers√£o minimizada
- Sequ√™ncia completa com badges
  - Verde: j√° passou
  - Amarelo: pr√≥ximo esperado
  - Cinza: ainda n√£o alcan√ßado
- Gr√°fico de linha com √∫ltimos 20 eventos (hit/miss)
- Progresso visual (barra)
- Estat√≠sticas detalhadas:
  - Acertos totais
  - Erros totais
  - Taxa de acerto
  - Alertas configurados
- Para number-set: estat√≠sticas de sequ√™ncias consecutivas

**Sistema de Prioridade**:
- Estrat√©gias podem ser marcadas como priorit√°rias
- Destacadas com borda amarela e badge "PRIORIDADE"
- Aparecem no topo da lista
- Ativa√ß√£o autom√°tica via alertas configurados

#### 2.4 Alertas e Notifica√ß√µes

**Configura√ß√£o de Alertas**:
- Alerta ap√≥s X acertos consecutivos
- Alerta ap√≥s X erros consecutivos
- Quando ativado, estrat√©gia vira priorit√°ria
- Toast notification + som de alerta

**Sons**:
- Arquivo de √°udio embutido (base64)
- Reproduz automaticamente em alertas
- Configur√°vel por estrat√©gia

#### 2.5 Reset de Estrat√©gias

**Reset Individual**:
- Reseta uma estrat√©gia espec√≠fica
- Mant√©m configura√ß√£o (nome, tipo, sequ√™ncia, alertas)
- Zera estat√≠sticas (hits, misses, streaks, hist√≥rico)

**Reset Global** (NOVO):
- Bot√£o "Resetar Todas"
- Reseta todas as estrat√©gias de uma vez
- Toast de confirma√ß√£o
- Preserva configura√ß√µes, zera apenas estat√≠sticas

---

### 3. **An√°lise Estat√≠stica**

#### 3.1 Estat√≠sticas Gerais
- Total de resultados
- Contagem por cor (vermelho, preto, verde)
- Contagem por paridade (par, √≠mpar)
- √öltimo n√∫mero
- Taxa de verde (porcentagem de zeros)

#### 3.2 N√∫meros Quentes e Frios (Hot/Cold Numbers)
- **Quentes**: n√∫meros mais frequentes (top 10)
- **Frios**: n√∫meros menos frequentes (bottom 10)
- Visualiza√ß√£o com gr√°fico de barras
- Contagem e porcentagem
- Cores vibrantes (gradientes)

#### 3.3 Correla√ß√£o de N√∫meros

**Vers√£o Completa (tab An√°lise)**:
- Analisa √∫ltimos 100 resultados
- Identifica n√∫meros que aparecem frequentemente ap√≥s outros
- Top 10 correla√ß√µes mais fortes
- Para cada n√∫mero: mostra os 3 n√∫meros mais prov√°veis de aparecer depois
- Porcentagens e contagens

**Vers√£o Compacta (tab Entrada)** (NOVO):
- Mostra apenas top 5 correla√ß√µes
- Minimiz√°vel/expans√≠vel
- Aparece acima do hist√≥rico recente
- Interface compacta para mobile

#### 3.4 Sequ√™ncias de Estrat√©gias
- Gr√°fico de linha mostrando evolu√ß√£o de cada estrat√©gia
- Eixo Y: vit√≥rias acumuladas
- Cores diferentes por estrat√©gia
- Legenda interativa

---

### 4. **Gerenciamento de Dados**

#### 4.1 Exporta√ß√£o

**JSON**:
```json
{
  "results": [10, 25, 3, ...],
  "strategies": [
    {
      "name": "Cor Vermelha",
      "type": "color",
      "sequence": [...],
      "hits": 45,
      "misses": 38,
      ...
    }
  ],
  "exportDate": "2025-10-26T..."
}
```

**CSV**:
```csv
N√∫mero,Cor,Par/√çmpar,Intervalo,D√∫zia,Coluna,Timestamp
25,Vermelho,√çmpar,Alto,Terceira,1,2025-10-26...
```

#### 4.2 Importa√ß√£o
- Suporta JSON exportado pelo pr√≥prio app
- Valida estrutura antes de importar
- Limpa dados atuais antes de importar
- Feedback com toast

#### 4.3 Limpar Tudo
- Remove todos os resultados
- Remove todas as estrat√©gias
- Confirma√ß√£o obrigat√≥ria

---

### 5. **Interface e Responsividade**

#### 5.1 Tema Claro/Escuro
- Toggle no header
- Persist√™ncia via localStorage
- Transi√ß√µes suaves
- Design system baseado em tokens CSS (HSL)
- Todas as cores s√£o sem√¢nticas (--primary, --secondary, etc)

#### 5.2 Layout Responsivo

**Desktop**:
- Grid de 2 colunas em v√°rias se√ß√µes
- Tabs horizontais
- Estrat√©gias expandem lateralmente

**Tablet**:
- Grid adapta para coluna √∫nica em telas menores
- Bot√µes mant√™m tamanho adequado

**Mobile**:
- Stack vertical
- Estrat√©gias com padding reduzido
- Texto ajusta tamanho (text-sm ‚Üí text-xs)
- Bot√µes com √≠cones menores
- Grid de n√∫meros compacto
- Scroll horizontal onde necess√°rio
- **Corre√ß√µes aplicadas**: overflow controlado, flex-wrap, whitespace-nowrap em badges

#### 5.3 Tabs de Navega√ß√£o

**üé≤ Entrada**:
- Entrada de n√∫meros (manual/upload)
- **Correla√ß√£o de n√∫meros compacta** (NOVO)
- Estrat√©gias monitoradas (resumo)
- Hist√≥rico recente (√∫ltimos 20)

**üéØ Estrat√©gias**:
- Criador de estrat√©gias (formul√°rio)
- Lista de estrat√©gias (gerenciamento)
- Hist√≥rico de resultados

**üìä Dashboard**:
- **Gerenciador de dados** (export/import) (MOVIDO DA ABA ENTRADA)
- Estat√≠sticas gerais (cards)
- Hist√≥rico completo (at√© 50)

**üìà An√°lise**:
- Estat√≠sticas r√°pidas (cards)
- N√∫meros quentes e frios
- Sequ√™ncias de estrat√©gias (gr√°ficos)
- Correla√ß√£o de n√∫meros (completa)

---

### 6. **Fluxo de Processamento**

#### 6.1 Ordem de Atualiza√ß√£o (CR√çTICO)

Quando um n√∫mero √© adicionado:
1. **Primeiro**: processa o n√∫mero em todas as estrat√©gias ativas
2. **Depois**: adiciona o n√∫mero aos resultados
3. **Resultado**: garante que batch de n√∫meros seja processado corretamente

```typescript
const handleAddNumber = (num: number) => {
  processNumber(num);  // 1. Processa estrat√©gias
  addNumber(num);      // 2. Adiciona aos resultados
  toast.success(`N√∫mero ${num} adicionado!`);
};

const handleBatchAdd = (nums: number[]) => {
  nums.forEach(n => processNumber(n));  // 1. Processa cada um
  addBatch(nums);                       // 2. Adiciona em lote
  toast.success(`${nums.length} n√∫meros adicionados!`);
};
```

#### 6.2 L√≥gica de Estrat√©gias

**Estrat√©gias Simples (cor, paridade, etc)**:
```
Para cada n√∫mero novo:
  1. Verifica se corresponde ao esperado na sequ√™ncia
  2. Se SIM: avan√ßa progresso
  3. Se N√ÉO: 
     - Se estava no √∫ltimo elemento: conta erro
     - Se n√£o estava no √∫ltimo: apenas reseta progresso
  4. Verifica se n√∫mero inicia nova sequ√™ncia
```

**Number-Set**:
```
Para cada n√∫mero novo:
  1. Est√° no conjunto?
     - SIM e √© primeiro: inicia base (n√£o conta)
     - SIM e tinha base: conta acerto
  2. N√£o est√° no conjunto?
     - Tinha 1 acerto: conta erro MAS verifica se inicia nova base
     - Tinha 2+: registra streak, conta erro MAS verifica se inicia nova base
```

**Target-Numbers**:
```
Para cada n√∫mero novo:
  1. Est√° na base E no alvo?
     - Sem base ativa: inicia base
     - Com base ativa: ACERTO + reinicia base
  2. Apenas na base?
     - Sem base: inicia base
     - Com base: ERRO + verifica se reinicia base
  3. Apenas no alvo?
     - Com base: ACERTO + zera base
     - Sem base: ignora
  4. Nem base nem alvo?
     - Com base: ERRO
     - Sem base: ignora
```

---

### 7. **Persist√™ncia de Dados**

#### 7.1 LocalStorage
- Chave: `roulette-strategies`
- Armazena array de estrat√©gias
- Atualiza√ß√£o autom√°tica em toda mudan√ßa
- Recupera√ß√£o autom√°tica ao carregar app

#### 7.2 Hooks Customizados

**useLocalStorage**:
```typescript
const [state, setState] = useLocalStorage<T>(key, initialValue);
```

**useRouletteData**:
```typescript
const {
  results,      // n√∫mero[]
  stats,        // estat√≠sticas calculadas
  addNumber,    // adiciona um n√∫mero
  addBatch,     // adiciona m√∫ltiplos
  clearResults, // limpa tudo
  undoLast,     // remove √∫ltimo
} = useRouletteData();
```

**useStrategyMonitor**:
```typescript
const {
  strategies,         // Strategy[]
  addStrategy,        // cria nova
  removeStrategy,     // remove
  toggleStrategy,     // ativa/desativa
  resetStrategy,      // reseta uma
  resetAllStrategies, // reseta todas (NOVO)
  updateAlerts,       // configura alertas
  processNumber,      // processa n√∫mero (NOVO)
} = useStrategyMonitor(results);
```

---

### 8. **Backend (Lovable Cloud / Supabase)**

#### 8.1 Edge Function: extract-numbers-from-image

**Endpoint**: `/functions/v1/extract-numbers-from-image`

**M√©todo**: POST

**Request**:
```json
{
  "image": "data:image/jpeg;base64,/9j/4AAQ..."
}
```

**Valida√ß√µes**:
- Formato: deve ser base64 v√°lido
- Tamanho: m√°ximo 5MB
- Tipo: deve ser imagem

**Processamento**:
1. Extrai base64
2. Valida tamanho
3. Chama Google Gemini 2.5 Flash com prompt espec√≠fico
4. Parseia resposta JSON
5. Valida n√∫meros (0-36)

**Response**:
```json
{
  "numbers": [25, 10, 3, 18, 7],
  "message": "5 n√∫meros extra√≠dos"
}
```

**Errors**:
- 400: Imagem inv√°lida ou formato incorreto
- 413: Arquivo muito grande
- 500: Erro no processamento

**Seguran√ßa**:
- API key armazenada em vari√°vel de ambiente
- CORS configurado
- Rate limiting (Supabase nativo)

---

### 9. **Tecnologias Utilizadas**

#### 9.1 Frontend
- **React 18.3**: UI library
- **TypeScript**: Type safety
- **Vite**: Build tool
- **Tailwind CSS**: Styling
- **Radix UI**: Componentes acess√≠veis
- **Recharts**: Gr√°ficos
- **Sonner**: Toast notifications
- **Lucide React**: √çcones

#### 9.2 Backend
- **Lovable Cloud (Supabase)**
- **Edge Functions (Deno)**
- **Google Gemini 2.5 Flash**: OCR/IA

#### 9.3 Armazenamento
- **LocalStorage**: Dados do cliente
- **Base64**: Encoding de imagens

---

### 10. **Arquitetura de Arquivos**

```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/              # Componentes Shadcn/Radix
‚îÇ   ‚îú‚îÄ‚îÄ DataManager.tsx  # Export/Import
‚îÇ   ‚îú‚îÄ‚îÄ HotColdNumbers.tsx
‚îÇ   ‚îú‚îÄ‚îÄ NumberCorrelation.tsx  # Com modo compacto
‚îÇ   ‚îú‚îÄ‚îÄ NumberInput.tsx
‚îÇ   ‚îú‚îÄ‚îÄ RecentResults.tsx
‚îÇ   ‚îú‚îÄ‚îÄ StatsCard.tsx
‚îÇ   ‚îú‚îÄ‚îÄ StrategyCreator.tsx
‚îÇ   ‚îú‚îÄ‚îÄ StrategyMonitor.tsx    # Com reset all, mobile fixes
‚îÇ   ‚îú‚îÄ‚îÄ StrategyStreaks.tsx
‚îÇ   ‚îî‚îÄ‚îÄ ThemeToggle.tsx
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useLocalStorage.ts
‚îÇ   ‚îú‚îÄ‚îÄ useRouletteData.ts     # Com addBatch
‚îÇ   ‚îî‚îÄ‚îÄ useStrategyMonitor.ts  # Com processNumber, resetAll
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ evaluate.ts            # Fun√ß√µes puras de avalia√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ utils.ts
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ Index.tsx              # App principal
‚îÇ   ‚îî‚îÄ‚îÄ NotFound.tsx
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ strategy.ts
‚îú‚îÄ‚îÄ index.css              # Design system (tokens HSL)
‚îî‚îÄ‚îÄ main.tsx

supabase/
‚îî‚îÄ‚îÄ functions/
    ‚îî‚îÄ‚îÄ extract-numbers-from-image/
        ‚îî‚îÄ‚îÄ index.ts       # Edge function OCR

```

---

### 11. **Melhorias Implementadas**

#### Corre√ß√µes de Bugs:
‚úÖ Ordem de processamento: estrat√©gias atualizadas ANTES de adicionar aos resultados
‚úÖ L√≥gica de continuidade: n√∫meros que erram podem iniciar nova base
‚úÖ Target-numbers: suporte para n√∫meros que s√£o base E alvo simultaneamente
‚úÖ Mobile: overflow, wrapping, propor√ß√µes corrigidas

#### Novas Funcionalidades:
‚úÖ Reset global de estrat√©gias (bot√£o "Resetar Todas")
‚úÖ Correla√ß√£o compacta na aba Entrada
‚úÖ Pr√≥ximo segmento mostrado corretamente (baseado em currentProgress)
‚úÖ DataManager movido para Dashboard
‚úÖ processNumber() para processar antes de adicionar

#### Melhorias de UX:
‚úÖ Badges com whitespace-nowrap
‚úÖ Textos responsivos (sm/base/lg)
‚úÖ Bot√µes adaptados para mobile
‚úÖ Layout flex com wrap apropriado
‚úÖ Overflow controlado em estrat√©gias

---

### 12. **Como Usar**

#### 12.1 Adicionar Resultados
1. V√° para aba "üé≤ Entrada"
2. Clique nos n√∫meros ou fa√ßa upload de imagem
3. Veja os resultados aparecerem no hist√≥rico

#### 12.2 Criar Estrat√©gia
1. V√° para aba "üéØ Estrat√©gias"
2. Preencha nome e selecione tipo
3. Configure a sequ√™ncia/valores
4. (Opcional) Configure alertas
5. Clique em "Criar Estrat√©gia"

#### 12.3 Monitorar Estrat√©gias
1. Estrat√©gias aparecem nas abas "Entrada" e "Estrat√©gias"
2. Clique na seta para expandir/minimizar
3. Use o switch para ativar/desativar
4. Configure alertas pelo √≠cone de engrenagem
5. Resete individual (√≠cone de seta circular) ou todas (bot√£o "Resetar Todas")

#### 12.4 Analisar Dados
1. V√° para "üìä Dashboard" para vis√£o geral
2. V√° para "üìà An√°lise" para detalhes
3. Veja correla√ß√µes, quentes/frios, gr√°ficos
4. Exporte dados em JSON/CSV conforme necess√°rio

---

### 13. **Pr√≥ximos Passos Sugeridos**

- [ ] Adicionar testes unit√°rios (Vitest)
- [ ] Implementar CI/CD (GitHub Actions)
- [ ] Adicionar mais tipos de visualiza√ß√£o (pizza charts, heatmaps)
- [ ] Suporte para m√∫ltiplas sess√µes/salas
- [ ] Hist√≥rico de sess√µes com timestamps
- [ ] Compara√ß√£o de estrat√©gias lado a lado
- [ ] Exporta√ß√£o para PDF com relat√≥rios
- [ ] Modo offline completo (PWA)
- [ ] Notifica√ß√µes push para alertas
- [ ] Integra√ß√£o com APIs de cassinos online

---

## üöÄ Conclus√£o

Este √© um sistema profissional e completo para an√°lise de roleta, com foco em:
- **Precis√£o**: l√≥gica de estrat√©gias testada e validada
- **Performance**: hooks otimizados, memoiza√ß√£o, batch processing
- **UX**: responsivo, acess√≠vel, intuitivo
- **Escalabilidade**: arquitetura modular, componentes reutiliz√°veis
- **Seguran√ßa**: valida√ß√µes, edge functions, tokens sem√¢nticos

O app est√° pronto para uso em produ√ß√£o e pode ser facilmente estendido com novas funcionalidades.
